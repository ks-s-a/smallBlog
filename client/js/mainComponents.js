"use strict";var Container=React.createClass({displayName:"Container",getDefaultProps:function(){return{queryTimeout:1e3}},getInitialState:function(){return{tagNames:TAG_NAMES,tags:[],tagNum:{},storyLastQueryTime:null,stories:[],isEndReached:!1,lastStoryId:null}},_getArticleCount:function(){var t=this,e=JSON.stringify(this.state.tags),a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&this.responseText){var e=JSON.parse(this.responseText);t.setState({tagNum:e})}},a.open("GET","/getStoriesNumber?tags="+e,!0),a.send()},_getStoriesFromServer:function(){var t=Date.now();if(!(this.state.isEndReached||this.state.storyLastQueryTime&&t-this.state.storyLastQueryTime<this.props.queryTimeout)){var e=this,a=this.state.lastStoryId?"&last="+this.state.lastStoryId:"",s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==this.readyState&&this.responseText){var t=JSON.parse(this.responseText);if(!t.length)return console.log("No more stories!"),void e.setState({isEndReached:!0});var a=t.sort(function(t,e){return e.id-t.id}),s=a[a.length-1].id,n=e.state.stories;a.forEach(function(t){n.push(t)}),e.setState({lastStoryId:s,stories:n})}},s.open("GET","/getStories?tags="+JSON.stringify(this.state.tags)+a,!0),s.send(),this.setState({storyLastQueryTime:t})}},_isNeedExtraStories:function(t){this._isEndCommingSoon(t)&&this._getStoriesFromServer()},_isEndCommingSoon:function(){var t=(this.refs.heading.getDOMNode().getBoundingClientRect(),document.documentElement),e=document.body,a=t.scrollTop||e&&e.scrollTop||0;return a-=t.clientTop,t.scrollHeight-a<1.5*t.clientHeight},changeTags:function(t){var e=this.state.tags.slice(),a=e.indexOf(t);-1===a?e.push(t):e.splice(a,1),this.replaceState(this.getInitialState()),this.setState({tags:e},function(){this._getArticleCount(),this._getStoriesFromServer()})},componentWillMount:function(){document.addEventListener("scroll",this._isNeedExtraStories),this._getArticleCount(),this._getStoriesFromServer()},shouldComponentUpdate:function(t,e){return e.tagNum===this.state.tagNum&&e.lastStoryId===this.state.lastStoryId?!1:!0},render:function(){return React.createElement("div",{id:"content"},React.createElement("div",{className:"main-picture col-lg-3 col-md-3 col-sm-3 hidden-xs"},React.createElement("img",{src:"?var1"===window.location.search?"/i/lstori_1.png":"/i/lstori_2.png"}),React.createElement(TagList,{tagNames:this.state.tagNames,tags:this.state.tags,tagNum:this.state.tagNum,changeTagsFunction:this.changeTags})),React.createElement(MobileList,{tagNames:this.state.tagNames,tags:this.state.tags,tagNum:this.state.tagNum,changeTagsFunction:this.changeTags}),React.createElement("div",{id:"heading",ref:"heading",className:"col-lg-9 col-md-9 col-sm-9 col-xs-12"},React.createElement("h1",{id:"main-header"},"Истории с чувством!"),React.createElement(Stories,{stories:this.state.stories,tagNames:this.state.tagNames,tags:this.state.tags,changeTagsFunction:this.changeTags})))}}),MobileList=React.createClass({displayName:"MobileList",showList:function(){var t=document.getElementById("mobile-panel-content");t.classList.toggle("hide")},render:function(){var t=[];for(var e in this.props.tagNames)t.push(React.createElement(MobileListButton,{name:this.props.tagNames[e],state:-1!==this.props.tags.indexOf(+e),index:e,changeTagsFunction:this.props.changeTagsFunction,count:this.props.tagNum[e]}));return React.createElement("div",{id:"mobile-panel",className:"panel panel-default hidden-lg hidden-md hidden-sm col-xs-12"},React.createElement("div",{className:"panel-heading",onClick:this.showList},React.createElement("h3",{className:"panel-title"},"Выбрать тему")),React.createElement("div",{id:"mobile-panel-content",className:"panel-body "+(this.props.tags.length?"":"hide")},React.createElement("div",{className:"list-group"},t)))}}),MobileListButton=React.createClass({displayName:"MobileListButton",render:function(){return React.createElement("a",{href:"#",className:"list-group-item "+(this.props.state?"active":""),onClick:this.props.changeTagsFunction.bind(null,+this.props.index)},this.props.name," ",React.createElement("span",{className:"badge"},this.props.count))}}),TagList=React.createClass({displayName:"TagList",render:function(){var t=[];for(var e in this.props.tagNames)t.push(React.createElement(TagButton,{name:this.props.tagNames[e],state:-1!==this.props.tags.indexOf(+e),index:e,changeTagsFunction:this.props.changeTagsFunction,count:this.props.tagNum[e]}));return React.createElement("div",{id:"side-buttons"},React.createElement("h5",null,"Темы:"),React.createElement("ul",{className:"nav nav-pills nav-stacked"},t))}}),TagButton=React.createClass({displayName:"TagButton",render:function(){return React.createElement("li",{className:this.props.state?"active":""},React.createElement("a",{href:"#",onClick:this.props.changeTagsFunction.bind(null,+this.props.index)},this.props.name," ",React.createElement("span",{className:"badge"},this.props.count)))}}),Stories=React.createClass({displayName:"Stories",render:function(){var t=this,e=this.props.stories.map(function(e){return React.createElement(Story,{id:e.id,header:e.header,tags:e.tags,tagNames:t.props.tagNames,text:e.text,changeTagsFunction:t.props.changeTagsFunction})});return React.createElement("div",{id:"stories-container",ref:"storiesContainer",className:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},e)}}),Story=React.createClass({displayName:"Story",render:function(){var t=this,e=this.props.tags.map(function(e){return React.createElement("a",{href:"javascript:",className:"text-muted story-tag-link",onClick:t.props.changeTagsFunction.bind(null,+e)}," ","#"+t.props.tagNames[+e]," ")});return React.createElement("article",{name:"post"+this.props.id},React.createElement("h4",{className:"story-title"}," ",this.props.header," "),React.createElement("div",{className:"story-tags-area"},e),React.createElement("p",null," ",this.props.text," "),React.createElement("br",null))}});React.render(React.createElement(Container,null),document.getElementById("content-container"));