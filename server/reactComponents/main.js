<<<<<<< Updated upstream
var React=require("react"),Container=React.createClass({displayName:"Container",getDefaultProps:function(){return{storiesTheme:null,queryTimeout:1e3}},getInitialState:function(){return{storyLastQueryTime:null,stories:this.props.stories||[],isEndReached:!1,lastStoryId:this.props.stories?this.props.stories[this.props.stories.length-1].id:null}},_getStoriesFromServer:function(){var e=Date.now();if(!(this.state.isEndReached||this.state.storyLastQueryTime&&e-this.state.storyLastQueryTime<this.props.queryTimeout)){var t=this,r=this.state.lastStoryId?"?last="+this.state.lastStoryId:"",s=new XMLHttpRequest;this.props.storiesTheme&&(r+="&theme="+this.props.storiesTheme),s.onreadystatechange=function(){if(4==this.readyState&&this.responseText){var e=JSON.parse(this.responseText);if(!e||!e.length)return console.info("No more stories!"),t.setState({isEndReached:!0});var r=e.sort(function(e,t){return t.id-e.id}),s=r[r.length-1].id,a=t.state.stories;r.forEach(function(e){a.push(e)}),t.setState({lastStoryId:s,stories:a})}},s.open("GET","/getStories"+r,!0),s.send(),this.setState({storyLastQueryTime:e})}},_isNeedExtraStories:function(e){this._isEndCommingSoon(e)&&this._getStoriesFromServer()},_isEndCommingSoon:function(){var e=(document.getElementById("stories-container").getBoundingClientRect(),document.documentElement),t=document.body,r=e.scrollTop||t&&t.scrollTop||0;return r-=e.clientTop,e.scrollHeight-r<1.5*e.clientHeight},componentDidMount:function(){document.addEventListener("scroll",this._isNeedExtraStories)},render:function(){return React.createElement(Stories,{stories:this.state.stories,tagNames:this.props.tagNames,changeTagsFunction:this.changeTags,needEndMessage:this.state.isEndReached})}}),Stories=React.createClass({displayName:"Stories",render:function(){var e=this.props.stories.map(function(e,t){return React.createElement(Story,{key:"story-"+t,id:e.id,header:e.header,text:e.text})}).reduce(function(e,t,r){return e.concat(t).concat(React.createElement("p",{className:"story-separator",key:"story-separator-"+r},"♥ ♥ ♥"))},[]);return React.createElement("div",{id:"stories-container",className:"stories-container"},e,this.props.needEndMessage?React.createElement(NoStoryMes,null):"")}}),Story=React.createClass({displayName:"Story",_createParagraphs:function(e){return e.split("\n").map(function(e,t){return React.createElement("p",{itemProp:"articleSection",key:"p-num-"+t},e)})},render:function(){return React.createElement("article",{itemScope:!0,itemType:"http://schema.org/Article"},React.createElement("h3",{itemProp:"name"},this.props.header),React.createElement("meta",{itemProp:"inLanguage",content:"ru"}),React.createElement("meta",{itemProp:"genre",content:"love story"}),React.createElement("div",{itemProp:"articleBody"},this._createParagraphs(this.props.text)))}}),NoStoryMes=React.createClass({displayName:"NoStoryMes",render:function(){return React.createElement("div",{className:"stories-container__end-message"},React.createElement("p",null,"Ну вот и всё! Самое время написать ",React.createElement("a",{href:"/myStory"},"свою историю"),"!"))}});module.exports=Container;
=======
var React=require("react"),Container=React.createClass({displayName:"Container",getDefaultProps:function(){return{storiesTheme:null,queryTimeout:1e3}},getInitialState:function(){return{storyLastQueryTime:null,stories:this.props.stories||[],isEndReached:!1,lastStoryId:this.props.stories?this.props.stories[this.props.stories.length-1].id:null}},_getStoriesFromServer:function(){var e=Date.now();if(!(this.state.isEndReached||this.state.storyLastQueryTime&&e-this.state.storyLastQueryTime<this.props.queryTimeout)){var t=this,r=this.state.lastStoryId?"?last="+this.state.lastStoryId:"",s=new XMLHttpRequest;this.props.storiesTheme&&(r+="&theme="+this.props.storiesTheme),s.onreadystatechange=function(){if(4==this.readyState&&this.responseText){var e=JSON.parse(this.responseText);if(!e||!e.length)return console.info("No more stories!"),t.setState({isEndReached:!0});var r=e.sort(function(e,t){return t.id-e.id}),s=r[r.length-1].id,a=t.state.stories;r.forEach(function(e){a.push(e)}),t.setState({lastStoryId:s,stories:a})}},s.open("GET","/getStories"+r,!0),s.send(),this.setState({storyLastQueryTime:e})}},_isNeedExtraStories:function(e){this._isEndCommingSoon(e)&&this._getStoriesFromServer()},_isEndCommingSoon:function(){var e=(document.getElementById("stories-container").getBoundingClientRect(),document.documentElement),t=document.body,r=e.scrollTop||t&&t.scrollTop||0;return r-=e.clientTop,e.scrollHeight-r<1.5*e.clientHeight},componentDidMount:function(){document.addEventListener("scroll",this._isNeedExtraStories)},render:function(){return React.createElement(Stories,{stories:this.state.stories,tagNames:this.props.tagNames,changeTagsFunction:this.changeTags,needEndMessage:this.state.isEndReached})}}),Stories=React.createClass({displayName:"Stories",render:function(){var e=this.props.stories.map(function(e,t){return React.createElement(Story,{key:"story-"+t,id:e.id,header:e.header,text:e.text})}).reduce(function(e,t,r){return e.concat(t).concat(React.createElement("p",{className:"story-separator",key:"story-separator-"+r},"♥ ♥ ♥"))},[]);return React.createElement("div",{id:"stories-container",className:"stories-container"},e,this.props.needEndMessage?React.createElement(NoStoryMes,null):"")}}),Story=React.createClass({displayName:"Story",_createParagraphs:function(e){return e.split("\n").map(function(e,t){return React.createElement("p",{itemProp:"articleSection",key:"p-num-"+t},e)})},render:function(){return React.createElement("article",{itemScope:!0,itemType:"http://schema.org/Article"},React.createElement("h3",{itemProp:"name"},this.props.header),React.createElement("meta",{itemProp:"inLanguage",content:"ru"}),React.createElement("meta",{itemProp:"genre",content:"love story"}),React.createElement("div",{itemProp:"articleBody"},this._createParagraphs(this.props.text)))}}),NoStoryMes=React.createClass({displayName:"NoStoryMes",render:function(){return React.createElement("div",{className:"stories-container__end-message"},React.createElement("p",null,"Ну вот и всё! Самое время написать ",React.createElement("a",{href:"/myStory"},"свою историю"),"!"))}});module.exports=Container;
>>>>>>> Stashed changes
